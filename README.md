# 📄 **《Git 多仓库可视化分析工具 — 需求文档（PRD）》**

## 1. 项目背景 / Project Background

在大型企业开发环境中，一个工程师可能同时维护多个 Git 仓库。
用户希望能够选中一个包含多个项目的根目录，自动扫描所有 Git 仓库，并生成：

* 提交历史图表
* 代码增删量统计
* 作者贡献分布
* 仓库活跃度图（类似 GitHub 绿格子）

以便用于自我分析、团队周报、技术可视化、绩效展示等场景。

本工具通过 Electron 提供跨平台桌面应用能力，结合 Node.js 访问本地文件系统及 git 命令执行。

---

## 2. 项目目标 / Goals

构建一款桌面应用，能够：

✔ 同时处理多个 Git 仓库
✔ 自动提取 Git 数据
✔ 生成丰富可视化图表
✔ 高性能、可缓存
✔ 支持 Windows / macOS

---

# 3. 用户角色 / User Roles

| 角色            | 描述               |
| ------------- | ---------------- |
| 开发者（主要用户）     | 想查看自己多个项目的代码统计情况 |
| 技术主管 / Leader | 查看团队代码活跃度、贡献分布   |
| 数据分析者         | 需要从 Git 中提取结构化信息 |

---

# 4. 功能需求 / Functional Requirements

## 4.1 目录选择

用户可以：

* 选择一个任意本地目录（如开发根目录）
* 支持拖拽文件夹到窗口

系统自动扫描子目录，识别所有 Git 仓库（含 `.git` 目录）。

---

## 4.2 Git 仓库扫描

### 检测逻辑

* 递归扫描子文件夹
* 判断 `/.git` 是否存在
* 使用 `git rev-parse` 校验仓库有效性
* 将每个仓库加入扫描列表

### 仓库信息收集

每个仓库需要获取：

* 仓库名称、路径
* 当前分支
* 最近提交时间
* 最新 commit hash
* 总提交次数
* 作者列表
* 文件体积（可选）

---

## 4.3 Git 数据分析

应用需要对每个仓库执行 Git 命令，从而生成结构化数据。

### 4.3.1 提交统计（基础）

使用：

```
git log --since="1 year ago" --pretty=format:%H|%an|%ad --date=short
```

生成：

* 每日提交次数
* 作者贡献次数
* 仓库活跃天数

### 4.3.2 代码增删量统计（可选/开启耗时）

使用：

```
git log --numstat --since="1 year ago"
```

统计：

* 每日新增行数
* 每日删除行数
* 总新增/删除行数
* 每位作者新增/删除行数

可能会很慢，需要后台处理。

---

## 4.4 缓存系统（重要）

为了避免每次扫描都消耗大量时间，系统需要缓存：

* 每个仓库的统计结果
* 上次扫描时间
* 上次 HEAD commit hash

如果 hash 未变化，则无需重新扫描。

缓存结构例示：

```json
{
  "repoPath": "xxx",
  "lastHash": "a1b2c3",
  "lastUpdated": "2025-01-01",
  "stats": { ... }
}
```

---

## 4.5 可视化展示（Frontend）

### 4.5.1 仓库列表页

每个仓库展示：

* 名称
* 路径
* 是否已缓存
* 最新提交时间
* 活跃度评分（计算规则后面定义）

### 4.5.2 仓库详情页

包含以下图表：

| 图表                  | 描述           |
| ------------------- | ------------ |
| 日贡献图（类似 GitHub 绿格子） | 每日 commit 数量 |
| 作者贡献占比饼图            | 每位作者提交数      |
| 提交趋势折线图             | 时间 → 提交数     |
| 代码增删趋势图（可选）         | 时间 → 行数增删    |
| 文件类型占比图（可选）         | 统计文件类型比例     |

### 4.5.3 多仓库汇总（总览）

展示：

* 总提交次数
* 总新增/删除行数
* 所有作者贡献排行榜
* 所有仓库活跃度趋势

---

# 5. 用户体验（UX）需求

### 5.1 非阻塞界面

* 所有 Git 扫描任务必须异步执行
* 显示进度条（如“已扫描 3/20 个仓库”）
* 大型仓库需要显示“分析中...”状态

### 5.2 错误处理

* 仓库损坏 → 标记为“无效仓库”
* 无 git 可执行文件 → 提示用户选择 Git 路径
* 权限不足 → 提示手动授权

---

# 6. 技术需求 / Technical Requirements

## 6.1 框架

* Electron（主进程 + 渲染进程）
* Vite + Vue3
* Node.js child_process 执行 git 命令

## 6.2 模块需求

### 主进程

* 文件扫描模块（fs）
* Git 执行引擎（child_process.spawn）
* 数据缓存模块
* IPC 服务端

### 前端（渲染进程）

* UI 框架（Vue）
* 图表库（ECharts / Chart.js / visx）
* IPC 客户端接口

## 6.3 跨平台兼容

* Windows、macOS 均支持
* Git 可执行文件路径自动检测
* 路径分隔符统一使用 `path.join`

---

# 7. 性能要求 / Performance Requirements

| 指标        | 要求                   |
| --------- | -------------------- |
| 扫描 20 个仓库 | < 2 秒（不含深度 Git 分析）   |
| 单仓库提交数据分析 | < 1 秒（小型仓库）          |
| 大型仓库扫描    | 可接受 10~60 秒，必须异步+可取消 |
| UI 渲染     | 不得出现明显卡顿             |

---

# 8. 安全要求 / Security

* 不上传任何数据到云端
* 所有 Git 数据均在本地使用
* 应用无需网络权限

---

# 9. 风险识别与解决方案

| 风险           | 描述               | 解决方案                        |
| ------------ | ---------------- | --------------------------- |
| Git 仓库数量影响性能 | IO 消耗大           | 使用缓存 + 延迟加载                 |
| diff 行数统计极慢  | 多仓库+大量提交         | 可选开启 “行数统计”                 |
| 跨平台 git 路径不同 | Windows 常找不到 git | 自动检测 + 用户手动设置               |
| 用户目录非常深      | 一次扫描耗时长          | 限制最大深度，或跳过 node_modules 等目录 |
| 渲染进程卡顿       | 重数据渲染            | 使用 WebWorker 或后台线程          |

---

# 10. 开发阶段规划（Milestones）

### **M1：基础功能（核心可用）**

* 目录选择
* 扫描 Git 仓库
* 获取提交次数、作者列表
* 基础图表展示

### **M2：Git 深度分析（增强）**

* 日贡献图（绿格子）
* 作者贡献饼图
* 仓库活跃度统计

### **M3：性能优化**

* 缓存策略
* 后台任务 + 进度条

### **M4：高级功能（可选）**

* 代码增删行数统计
* 文件类型统计
* 多仓库比较分析

